name: Build Android APK AutomÃ¡tico
permissions:
  contents: read 
on:
  push:
    branches: [main]
  workflow_dispatch:  # Permite ejecutar manualmente

jobs:
  build-apk:
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. Descargar proyecto
      uses: actions/checkout@v4
      
    - name: 2. Descargar Godot 4.4.1
      run: |
        wget -q https://github.com/godotengine/godot/releases/download/4.4.1-stable/Godot_v4.4.1-stable_linux.x86_64.zip
        unzip -q Godot_v4.4.1-stable_linux.x86_64.zip
        chmod +x Godot_v4.4.1-stable_linux.x86_64
        echo "âœ… Godot descargado"
        
    - name: 3. Verificar estructura
      run: |
        echo "ğŸ“ Estructura del proyecto:"
        ls -la
        echo "ğŸ“ Dentro de fnf-2-try:"
        ls -la fnf-2-try/
        echo "ğŸ“„ Contenido de export_presets.cfg:"
        cat fnf-2-try/export_presets.cfg || echo "No encontrado"
        
    - name: 4. Crear APK Android
      run: |
        cd fnf-2-try
        echo "ğŸ® Exportando APK desde fnf-2-try..."
        ../Godot_v4.4.1-stable_linux.x86_64 --headless --export-debug "Android" ../musical_sniffle.apk
        echo "âœ… APK creado"
        
    - name: 5. Verificar APK creado
      run: |
        echo "ğŸ“¦ Archivos creados:"
        ls -lh *.apk || echo "âš ï¸ No hay APK"
        
    - name: 6. Subir APK para descargar
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: Musical-Sniffle-APK
        path: musical_sniffle.apk
        retention-days: 7
